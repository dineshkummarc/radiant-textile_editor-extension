- content_for 'popups' do
  #image-popup.popup{:style => "display: none"}
    %h3 Add Image
    %form#image_transform_form.transform_form{ :name => "transform_form" }
      .transform_container
        .transform_title
          %strong 1. Choose Image:
        .add_border_container
          .transform_choice_container
            #image_transform_choice_web.transform_choice.transform_current
              %label
                %input{:type => "radio", :name => "transform_choice", :value => "web", :checked => true}
                \ Web Address
            - if @page && @page.respond_to?(:attachments)
              #image_transform_choice_attachment.transform_choice
                %label
                  %input{:type => "radio", :name => "transform_choice", :value => "attachment"}
                  \ Attachment
            - if @page && @page.respond_to?(:assets)
              #image_transform_choice_asset.transform_choice
                %label
                  %input{:type => "radio", :name => "transform_choice", :value => "asset"}
                  \ Attached asset
              #image_transform_choice_bucket.transform_choice
                %label
                  %input{:type => "radio", :name => "transform_choice", :value => "bucket"}
                  \ Bucket asset
          .transform_input_container
            #image_transform_input_web.transform_input
              %input#img_web_text{:type => "text", :name => "img_web_text", :value => "", :size => "30"}
              %p.help
                Paste the URL of an existing image on your site.
            - if @page && @page.respond_to?(:attachments)
              #image_transform_input_attachment.transform_input{:style => "display:none;"}
                - if @page.self_or_ancestors_have_attachments?
                  = select_tag('img_attachment_text',  option_groups_from_collection_for_select(@page.self_and_ancestors, :attachments, :title, :filename, :filename))
                  %p.help
                    %strong Is your image the right size and type?
                    Images need to be resized and compressed for the web using a graphics program like Photoshop.
                - else 
                  %p.warning There are no images attached to this page. Attach one and save changes, then return here to insert it.
            - if @page && @page.respond_to?(:assets)
              #image_transform_input_asset.transform_input{:style => "display:none;"}
                - if @page.assets.images.any?
                  - @page.assets.images.each do |asset|
                    %input{:type => "radio", :id => "img_asset_#{asset.id}", :class => "asset_picker", :name => "img_asset_id", :value => asset.id}
                    %label{:for => "img_asset_#{asset.id}"}
                      = image_tag(asset.thumbnail(:thumbnail), :id => "img_asset_#{asset.id}_thumbnail", :class => 'asset_thumbnail')
                  %p
                    %label{:for => 'img_asset_size'} Image size
                    = select_tag('img_asset_size',  options_from_collection_for_select(Asset.thumbnail_names + [:original], 'to_s', 'to_s'))
                - else 
                  %p.warning 
                    There are no images attached to this page. Use the Assets bucket to add some and then come back here.
              #image_transform_input_bucket.transform_input{:style => "display:none;"}
                - if session[:bucket]
                  - session[:bucket].each do |url, info| 
                    - asset = Asset.find(info[:id]) rescue nil
                    - if asset
                      %input{:type => "radio", :id => "img_bucket_#{asset.id}", :class => "asset_picker", :name => "img_asset_id", :value => asset.id}
                      %label{:for => "img_bucket_#{asset.id}"}
                        = image_tag(asset.thumbnail(:thumbnail), :id => "img_bucket_#{asset.id}_thumbnail", :class => 'asset_thumbnail')
                  %p
                    %label{:for => 'img_asset_size'} Image size
                    = select_tag('img_asset_size', options_from_collection_for_select(Asset.thumbnail_names + [:original], 'to_s', 'to_s'))
                - else 
                  %p.warning 
                    There are no images in your bucket. Use the main 
                    = link_to "assets page", assets_url
                    to add some and then come back here
          %br{:clear => "all"}/
      .transform_container
        .transform_title
          %strong 2. Alternate text:
          %input#alt_text{:type => "text", :size => "25", :name => "alt_text"}
      %button#image-popup-submit.submit{:type=>"button"} Submit
      or
      = link_to_function('Cancel', :class => 'close-link') {|page| page.hide 'image-popup' }